name: Build
on: push
jobs:
  UbuntuRun:
    runs-on: ubuntu-latest
    steps:
      - uses: Jimver/cuda-toolkit@v0.2.16
        id: cuda-toolkit
        with:
          cuda: '11.7.0'
          linux-local-args: '["--toolkit"]'      
      - run: nvcc -V  

      - name: Install gtest manually
        run: sudo apt-get install libgtest-dev && cd /usr/src/gtest && sudo cmake CMakeLists.txt && sudo make && sudo cp lib/*.a /usr/lib && sudo ln -s /usr/lib/libgtest.a /usr/local/lib/libgtest.a && sudo ln -s /usr/lib/libgtest_main.a /usr/local/lib/libgtest_main.a

      - name: Checkout
        uses: actions/checkout@v3

      - name: Create build directory
        run: mkdir ${{github.workspace}}/build  

      - name: Configure CMake
        working-directory: ${{github.workspace}}/build
        run: cmake ../

      - name: Run make
        working-directory: ${{github.workspace}}/build
        run: make -j      

      - run: echo "This job's status is ${{ job.status }}."

       # Run the tests using the downloaded build artifacts
      - name: Run CTest (Unit Tests)
        working-directory: ${{github.workspace}}/build
        run: ctest --output-on-failure
      
      # Upload build artifacts to be used in the separate test workflow
      #- name: Upload Build Artifacts
      #  uses: actions/upload-artifact@v4
      #  with:
      #    name: build-artifacts
      #    path: ${{github.workspace}}/build
      
      

